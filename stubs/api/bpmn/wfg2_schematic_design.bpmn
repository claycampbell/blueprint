<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  id="Definitions_WFG2"
                  targetNamespace="http://blueprint.dev/bpmn/wfg2">

  <bpmn:process id="WFG2_SchematicDesign" name="WFG2: Schematic Design" isExecutable="true">

    <bpmn:startEvent id="WFG2_Start" name="Start WFG2">
      <bpmn:outgoing>Flow_WFG2_Start_to_WFI1</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- WFI-1: Design Development -->
    <bpmn:userTask id="WFG2_WFI1" name="WFI-1: Design Development">
      <bpmn:incoming>Flow_WFG2_Start_to_WFI1</bpmn:incoming>
      <bpmn:incoming>Flow_WFI2_Back_to_WFI1</bpmn:incoming>
      <bpmn:outgoing>Flow_WFG2_WFI1_to_Gateway1</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Gateway after WFI1 -->
    <bpmn:exclusiveGateway id="WFG2_Gateway1" name="WFI1 Decision" default="Flow_WFI1_to_WFI2">
      <bpmn:incoming>Flow_WFG2_WFI1_to_Gateway1</bpmn:incoming>
      <bpmn:outgoing>Flow_WFI1_to_WFI2</bpmn:outgoing>
      <bpmn:outgoing>Flow_WFI1_Complete_WFG</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- WFI-2: Design Review -->
    <bpmn:userTask id="WFG2_WFI2" name="WFI-2: Design Review">
      <bpmn:incoming>Flow_WFI1_to_WFI2</bpmn:incoming>
      <bpmn:outgoing>Flow_WFG2_WFI2_to_Gateway2</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Gateway after WFI2 -->
    <bpmn:exclusiveGateway id="WFG2_Gateway2" name="WFI2 Decision" default="Flow_WFI2_to_End">
      <bpmn:incoming>Flow_WFG2_WFI2_to_Gateway2</bpmn:incoming>
      <bpmn:outgoing>Flow_WFI2_to_End</bpmn:outgoing>
      <bpmn:outgoing>Flow_WFI2_Back_to_WFI1</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <bpmn:endEvent id="WFG2_End" name="WFG2 Complete">
      <bpmn:incoming>Flow_WFI2_to_End</bpmn:incoming>
      <bpmn:incoming>Flow_WFI1_Complete_WFG</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_WFG2_Start_to_WFI1" sourceRef="WFG2_Start" targetRef="WFG2_WFI1"/>

    <!-- WFI1 Gateway flows -->
    <bpmn:sequenceFlow id="Flow_WFG2_WFI1_to_Gateway1" sourceRef="WFG2_WFI1" targetRef="WFG2_Gateway1"/>
    <bpmn:sequenceFlow id="Flow_WFI1_to_WFI2" name="approve" sourceRef="WFG2_Gateway1" targetRef="WFG2_WFI2"/>
    <bpmn:sequenceFlow id="Flow_WFI1_Complete_WFG" name="complete_wfg" sourceRef="WFG2_Gateway1" targetRef="WFG2_End">
      <bpmn:conditionExpression xsi:type="tFormalExpression">decision_action == "complete_wfg"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <!-- WFI2 Gateway flows -->
    <bpmn:sequenceFlow id="Flow_WFG2_WFI2_to_Gateway2" sourceRef="WFG2_WFI2" targetRef="WFG2_Gateway2"/>
    <bpmn:sequenceFlow id="Flow_WFI2_to_End" name="approve" sourceRef="WFG2_Gateway2" targetRef="WFG2_End"/>
    <bpmn:sequenceFlow id="Flow_WFI2_Back_to_WFI1" name="send_back_wfi1" sourceRef="WFG2_Gateway2" targetRef="WFG2_WFI1">
      <bpmn:conditionExpression xsi:type="tFormalExpression">decision_action == "send_back" and target_wfi == "WFI1"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_WFG2">
    <bpmndi:BPMNPlane id="BPMNPlane_WFG2" bpmnElement="WFG2_SchematicDesign">
      <bpmndi:BPMNShape id="WFG2_Start_di" bpmnElement="WFG2_Start">
        <dc:Bounds x="152" y="192" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="WFG2_WFI1_di" bpmnElement="WFG2_WFI1">
        <dc:Bounds x="250" y="170" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="WFG2_Gateway1_di" bpmnElement="WFG2_Gateway1" isMarkerVisible="true">
        <dc:Bounds x="415" y="185" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="WFG2_WFI2_di" bpmnElement="WFG2_WFI2">
        <dc:Bounds x="530" y="170" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="WFG2_Gateway2_di" bpmnElement="WFG2_Gateway2" isMarkerVisible="true">
        <dc:Bounds x="695" y="185" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="WFG2_End_di" bpmnElement="WFG2_End">
        <dc:Bounds x="812" y="192" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <!-- Sequence Flow Edges -->
      <bpmndi:BPMNEdge id="Flow_WFG2_Start_to_WFI1_di" bpmnElement="Flow_WFG2_Start_to_WFI1">
        <di:waypoint x="188" y="210"/>
        <di:waypoint x="250" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFG2_WFI1_to_Gateway1_di" bpmnElement="Flow_WFG2_WFI1_to_Gateway1">
        <di:waypoint x="350" y="210"/>
        <di:waypoint x="415" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFI1_to_WFI2_di" bpmnElement="Flow_WFI1_to_WFI2">
        <di:waypoint x="465" y="210"/>
        <di:waypoint x="530" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFI1_Complete_WFG_di" bpmnElement="Flow_WFI1_Complete_WFG">
        <di:waypoint x="440" y="235"/>
        <di:waypoint x="440" y="300"/>
        <di:waypoint x="830" y="300"/>
        <di:waypoint x="830" y="228"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFG2_WFI2_to_Gateway2_di" bpmnElement="Flow_WFG2_WFI2_to_Gateway2">
        <di:waypoint x="630" y="210"/>
        <di:waypoint x="695" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFI2_to_End_di" bpmnElement="Flow_WFI2_to_End">
        <di:waypoint x="745" y="210"/>
        <di:waypoint x="812" y="210"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_WFI2_Back_to_WFI1_di" bpmnElement="Flow_WFI2_Back_to_WFI1">
        <di:waypoint x="720" y="185"/>
        <di:waypoint x="720" y="120"/>
        <di:waypoint x="300" y="120"/>
        <di:waypoint x="300" y="170"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions>
